#!/usr/bin/perl

$header = <>;
$header = <>;

# 982324

$min = -1.523;
$max = 4.418;

$width = 14000;
$height = 20;

print "0 setlinewidth\n";

while (<>) {
	chomp;
	($date, $level) = split(/,/);

	$year = $date;
	$year =~ s/-.*//;

	$x{$year} += $seq / 982324 * $width;
	$y{$year} += $level;
	$count{$year}++;

	$avg += ($level - $min) * $height / ($max - $min);
	$count++;

	printf("%.6f %.6f %s\n",
		$seq++ / 982324 * $width,
		($level - $min) * $height / ($max - $min),
		$within ? "lineto" : "moveto");

	$within = 1;

	if ($seq % 200 == 0) {
		print "stroke\n";
		printf("%.6f %.6f %s\n",
			$seq++ / 982324 * $width,
			($level - $min) * $height / ($max - $min),
			"moveto");
	}
}

if ($within) {
	print "stroke\n";
	$within = 0;
}

print "0 setlinewidth\n";

$maxavg = $y{1910} / $count{1910};
$minavg = $y{1910} / $count{1910};

for $year (sort(keys(%count))) {
	$v = $y{$year} / $count{$year};

	if ($v > $maxavg) {
		$maxavg = $v;
	}
	if ($v < $minavg) {
		$minavg = $v;
	}
}

for $year (sort(keys(%count))) {
	printf("%.6f %.6f %s %% %s\n",
		$x{$year} / $count{$year},
		($y{$year} / $count{$year} - $minavg) * $height / ($maxavg - $minavg),
		$within ? "lineto" : "moveto",
		$year);

	$within = 1;
}

print "stroke\n";
